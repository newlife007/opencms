# âœ… APIç›¸å¯¹è·¯å¾„é…ç½®ä¿®å¤å®Œæˆ

**ä¿®å¤æ—¶é—´**: 2026-02-01 15:37  
**é—®é¢˜**: å‰ç«¯ä½¿ç”¨ç»å¯¹è·¯å¾„ `http://localhost:8080` è®¿é—®API  
**è§£å†³**: ä¿®æ”¹ä¸ºç›¸å¯¹è·¯å¾„ `/api`ï¼Œé€šè¿‡Nginxä»£ç†è®¿é—®  
**çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶éªŒè¯

---

## ğŸ” é—®é¢˜åˆ†æ

### å‘ç°çš„é—®é¢˜

**é—®é¢˜ä½ç½®**: `frontend/.env.development`

```bash
# âŒ é”™è¯¯é…ç½®ï¼ˆç»å¯¹è·¯å¾„ï¼‰
VITE_API_BASE_URL=http://localhost:8080/api
```

**å½±å“**:
- âŒ å‰ç«¯ç›´æ¥è®¿é—®åç«¯ 8080 ç«¯å£
- âŒ ç»•è¿‡äº† Nginx ä»£ç†
- âŒ è·¨åŸŸè®¿é—®é—®é¢˜
- âŒ ä¸ç¬¦åˆç›¸å¯¹è·¯å¾„è®¾è®¡

### è¯·æ±‚æµç¨‹å¯¹æ¯”

**ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰**:
```
æµè§ˆå™¨è®¿é—®: http://13.217.210.142/
  â†“
Nginx :80 â†’ Vueå‰ç«¯ :3000
  â†“
å‰ç«¯JSç›´æ¥è¯·æ±‚: http://localhost:8080/api â† ç»•è¿‡Nginx
  â†“
åç«¯API :8080 â† è·¨åŸŸé—®é¢˜
```

**ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰**:
```
æµè§ˆå™¨è®¿é—®: http://13.217.210.142/
  â†“
Nginx :80 â†’ Vueå‰ç«¯ :3000
  â†“
å‰ç«¯JSè¯·æ±‚: /api (ç›¸å¯¹è·¯å¾„)
  â†“
æµè§ˆå™¨è§£æä¸º: http://13.217.210.142/api
  â†“
Nginxä»£ç†: /api â†’ localhost:8080/api
  â†“
åç«¯API :8080 â† æ— è·¨åŸŸé—®é¢˜
```

---

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. ä¿®æ”¹å¼€å‘ç¯å¢ƒé…ç½®

**æ–‡ä»¶**: `frontend/.env.development`

```diff
- # API Base URL
- VITE_API_BASE_URL=http://localhost:8080/api
+ # API Base URL - ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡Nginxä»£ç†
+ VITE_API_BASE_URL=/api
```

### 2. ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒé…ç½®

**æ–‡ä»¶**: `frontend/.env.production`

```diff
- # API Base URL (will be replaced during deployment)
- VITE_API_BASE_URL=__API_BASE_URL__
+ # API Base URL - ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé€šè¿‡Nginxä»£ç†
+ VITE_API_BASE_URL=/api
```

### 3. æ›´æ–°Viteé…ç½®

**æ–‡ä»¶**: `frontend/vite.config.js`

```diff
  server: {
    host: '0.0.0.0',
    port: 3000,
-   proxy: {
-     '/api': {
-       target: process.env.VITE_API_BASE_URL || 'http://localhost:8080',
-       changeOrigin: true,
-     },
-   },
+   // æ³¨æ„ï¼šå¼€å‘ç¯å¢ƒä¸­ï¼Œå‰ç«¯é€šè¿‡Nginxä»£ç†è®¿é—®API
+   // å¦‚æœç›´æ¥è®¿é—®å‰ç«¯ :3000ï¼Œéœ€è¦å¼€å¯ä»¥ä¸‹ä»£ç†é…ç½®
+   // proxy: {
+   //   '/api': {
+   //     target: 'http://localhost:8080',
+   //     changeOrigin: true,
+   //   },
+   // },
  },
```

**è¯´æ˜**:
- ç¦ç”¨äº†Viteçš„å¼€å‘ä»£ç†
- ç»Ÿä¸€é€šè¿‡Nginxä»£ç†è®¿é—®
- æ³¨é‡Šä¿ç•™äº†ç›´æ¥è®¿é—®çš„é…ç½®æ–¹æ¡ˆ

### 4. é‡å¯å‰ç«¯æœåŠ¡

```bash
# é‡å¯å‰ç«¯ä½¿é…ç½®ç”Ÿæ•ˆ
kill <vite-pid>
cd frontend && npm run dev
```

---

## ğŸ§ª éªŒè¯æµ‹è¯•

### 1. æµ‹è¯•Nginxå¥åº·æ£€æŸ¥

```bash
curl http://localhost/health
```

**ç»“æœ**: âœ…
```json
{"service":"openwan-api","status":"healthy","version":"1.0.0"}
```

### 2. æµ‹è¯•API Ping

```bash
curl http://localhost/api/v1/ping
```

**ç»“æœ**: âœ…
```json
{"message":"pong","success":true}
```

### 3. æµ‹è¯•ç™»å½•API

```bash
curl -X POST http://localhost/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"wrongpass"}'
```

**ç»“æœ**: âœ…
```json
{"message":"Invalid credentials","success":false}
```

### 4. æµ‹è¯•å‰ç«¯è®¿é—®

```bash
curl http://localhost/ | grep "<title>"
```

**ç»“æœ**: âœ… è¿”å›HTMLé¡µé¢

---

## ğŸ“Š é…ç½®è¯´æ˜

### API Base URL é…ç½®

**ä½œç”¨**: è®¾ç½®Axiosè¯·æ±‚çš„åŸºç¡€URL

**æ–‡ä»¶**: `frontend/src/utils/request.js`

```javascript
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api', // â† è¯»å–ç¯å¢ƒå˜é‡
  timeout: 30000,
  withCredentials: true,
})
```

### ç¯å¢ƒå˜é‡åŠ è½½

| ç¯å¢ƒ | æ–‡ä»¶ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| å¼€å‘ | `.env.development` | `npm run dev` |
| ç”Ÿäº§ | `.env.production` | `npm run build` |

**å½“å‰é…ç½®**:
```bash
# ä¸¤ä¸ªç¯å¢ƒéƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„
VITE_API_BASE_URL=/api
```

### APIè¯·æ±‚ç¤ºä¾‹

**å‰ç«¯ä»£ç ** (`src/api/auth.js`):
```javascript
export default {
  login(data) {
    return request({
      url: '/v1/auth/login',  // â† ç›¸å¯¹è·¯å¾„
      method: 'post',
      data,
    })
  }
}
```

**å®é™…è¯·æ±‚**:
```
baseURL: /api
url: /v1/auth/login
â†’ å®Œæ•´è·¯å¾„: /api/v1/auth/login
â†’ æµè§ˆå™¨è§£æ: http://13.217.210.142/api/v1/auth/login
â†’ Nginxä»£ç†: â†’ http://localhost:8080/api/v1/auth/login
```

---

## ğŸŒ è®¿é—®æ–¹å¼

### æ¨èè®¿é—®ï¼ˆé€šè¿‡Nginxï¼‰

**å‰ç«¯è®¿é—®**:
```
http://13.217.210.142/
```

**å‰ç«¯JSå‘èµ·çš„APIè¯·æ±‚**:
```
fetch('/api/v1/auth/login')
â†“ æµè§ˆå™¨è‡ªåŠ¨è§£æä¸º
http://13.217.210.142/api/v1/auth/login
â†“ Nginxä»£ç†åˆ°
http://localhost:8080/api/v1/auth/login
```

### ç›´æ¥è®¿é—®ï¼ˆä¸æ¨èï¼‰

å¦‚æœç›´æ¥è®¿é—®å‰ç«¯ `:3000` ç«¯å£ï¼š
```
http://13.217.210.142:3000/
```

éœ€è¦åœ¨ `vite.config.js` ä¸­**å¯ç”¨ä»£ç†**ï¼š
```javascript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
    },
  },
}
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|---------|------|
| `frontend/.env.development` | ç»å¯¹è·¯å¾„ â†’ ç›¸å¯¹è·¯å¾„ `/api` | âœ… å®Œæˆ |
| `frontend/.env.production` | å ä½ç¬¦ â†’ ç›¸å¯¹è·¯å¾„ `/api` | âœ… å®Œæˆ |
| `frontend/vite.config.js` | ç¦ç”¨Viteä»£ç†ï¼ˆä½¿ç”¨Nginxï¼‰ | âœ… å®Œæˆ |
| å‰ç«¯æœåŠ¡ | é‡å¯ä½¿é…ç½®ç”Ÿæ•ˆ | âœ… å®Œæˆ |

---

## ğŸ¯ é…ç½®åŸç†

### ä¸ºä»€ä¹ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Ÿ

**ç›¸å¯¹è·¯å¾„** (`/api`):
- âœ… æµè§ˆå™¨è‡ªåŠ¨è§£æä¸ºå½“å‰åŸŸå+è·¯å¾„
- âœ… è‡ªåŠ¨é€‚é…ä¸åŒç¯å¢ƒï¼ˆå¼€å‘/ç”Ÿäº§ï¼‰
- âœ… æ— è·¨åŸŸé—®é¢˜
- âœ… ä¾¿äºNginxä»£ç†ç®¡ç†

**ç»å¯¹è·¯å¾„** (`http://localhost:8080/api`):
- âŒ ç¡¬ç¼–ç åŸŸåå’Œç«¯å£
- âŒ è·¨åŸŸè®¿é—®é—®é¢˜
- âŒ æ— æ³•é€‚é…ä¸åŒç¯å¢ƒ
- âŒ ç»•è¿‡Nginxä»£ç†

### ç›¸å¯¹è·¯å¾„è§£æç¤ºä¾‹

**åœºæ™¯1: é€šè¿‡Nginxè®¿é—®**
```
æµè§ˆå™¨åœ°å€æ : http://13.217.210.142/
å‰ç«¯ä»£ç : fetch('/api/v1/ping')
â†“ æµè§ˆå™¨è§£æä¸º
http://13.217.210.142/api/v1/ping
```

**åœºæ™¯2: ç›´æ¥è®¿é—®å‰ç«¯ç«¯å£ï¼ˆéœ€è¦Viteä»£ç†ï¼‰**
```
æµè§ˆå™¨åœ°å€æ : http://13.217.210.142:3000/
å‰ç«¯ä»£ç : fetch('/api/v1/ping')
â†“ æµè§ˆå™¨è§£æä¸º
http://13.217.210.142:3000/api/v1/ping
â†“ Viteä»£ç†åˆ°
http://localhost:8080/api/v1/ping
```

---

## ğŸ”„ è¯·æ±‚æµç¨‹å›¾

### å®Œæ•´çš„APIè¯·æ±‚æµç¨‹

```
1. ç”¨æˆ·æµè§ˆå™¨
   â””â”€ è®¿é—®: http://13.217.210.142/
       â†“
2. Nginx :80
   â””â”€ ä»£ç†åˆ° Vueå‰ç«¯ :3000
       â†“
3. ç”¨æˆ·ç‚¹å‡»ç™»å½•
   â””â”€ å‰ç«¯JS: fetch('/api/v1/auth/login', {data})
       â†“
4. æµè§ˆå™¨è§£æç›¸å¯¹è·¯å¾„
   â””â”€ å®Œæ•´URL: http://13.217.210.142/api/v1/auth/login
       â†“
5. è¯·æ±‚å‘é€åˆ° Nginx :80
   â””â”€ åŒ¹é…è§„åˆ™: location /api/
       â†“
6. Nginxä»£ç†
   â””â”€ proxy_pass http://localhost:8080/api/
       â†“
7. Goåç«¯API :8080
   â””â”€ è·¯ç”±: /api/v1/auth/login
       â†“
8. å¤„ç†ç™»å½•é€»è¾‘
   â””â”€ è¿”å›JSONå“åº”
       â†“
9. Nginxè½¬å‘å“åº”
   â””â”€ è¿”å›ç»™æµè§ˆå™¨
       â†“
10. å‰ç«¯å¤„ç†å“åº”
    â””â”€ ç™»å½•æˆåŠŸ/å¤±è´¥
```

---

## ğŸ› ï¸ è°ƒè¯•æŠ€å·§

### 1. æ£€æŸ¥ç¯å¢ƒå˜é‡

**å¼€å‘ç¯å¢ƒ**:
```bash
cat frontend/.env.development
# åº”è¯¥æ˜¾ç¤º: VITE_API_BASE_URL=/api
```

**ç”Ÿäº§ç¯å¢ƒ**:
```bash
cat frontend/.env.production
# åº”è¯¥æ˜¾ç¤º: VITE_API_BASE_URL=/api
```

### 2. æµè§ˆå™¨æ£€æŸ¥ç½‘ç»œè¯·æ±‚

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° **Network** æ ‡ç­¾
3. ç‚¹å‡»ç™»å½•
4. æŸ¥çœ‹è¯·æ±‚URL

**æ­£ç¡®çš„URL**:
```
http://13.217.210.142/api/v1/auth/login  âœ…
```

**é”™è¯¯çš„URL**:
```
http://localhost:8080/api/v1/auth/login  âŒ (ç»å¯¹è·¯å¾„)
```

### 3. æ£€æŸ¥Nginxæ—¥å¿—

**è®¿é—®æ—¥å¿—**:
```bash
sudo tail -f /var/log/nginx/openwan_access.log
```

**åº”è¯¥çœ‹åˆ°**:
```
13.217.210.142 - - [01/Feb/2026:15:37:00 +0000] "POST /api/v1/auth/login HTTP/1.1" 200 ...
```

**é”™è¯¯æ—¥å¿—**:
```bash
sudo tail -f /var/log/nginx/openwan_error.log
```

### 4. æµ‹è¯•å‘½ä»¤

**ä»æœåŠ¡å™¨å†…æµ‹è¯•**:
```bash
# é€šè¿‡Nginxè®¿é—®
curl http://localhost/api/v1/ping

# ç›´æ¥è®¿é—®API
curl http://localhost:8080/api/v1/ping

# ä¸¤ä¸ªåº”è¯¥è¿”å›ç›¸åŒç»“æœ
```

**ä»å¤–éƒ¨æµ‹è¯•**:
```bash
# é€šè¿‡Nginxè®¿é—®
curl http://13.217.210.142/api/v1/ping
```

---

## âœ… éªŒè¯æ¸…å•

- [x] ä¿®æ”¹ `.env.development` ä¸ºç›¸å¯¹è·¯å¾„
- [x] ä¿®æ”¹ `.env.production` ä¸ºç›¸å¯¹è·¯å¾„
- [x] æ›´æ–° `vite.config.js` ç¦ç”¨ä»£ç†
- [x] é‡å¯å‰ç«¯æœåŠ¡
- [x] æµ‹è¯•å¥åº·æ£€æŸ¥é€šè¿‡
- [x] æµ‹è¯•API Pingé€šè¿‡
- [x] æµ‹è¯•ç™»å½•APIé€šè¿‡
- [x] éªŒè¯Nginxä»£ç†å·¥ä½œæ­£å¸¸

---

## ğŸ‰ æ€»ç»“

### ä¿®å¤å‰
- âŒ å‰ç«¯ä½¿ç”¨ç»å¯¹è·¯å¾„ `http://localhost:8080/api`
- âŒ ç»•è¿‡Nginxä»£ç†
- âŒ ç¡¬ç¼–ç åŸŸåç«¯å£
- âŒ è·¨åŸŸè®¿é—®é—®é¢˜

### ä¿®å¤å
- âœ… å‰ç«¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `/api`
- âœ… é€šè¿‡Nginxç»Ÿä¸€ä»£ç†
- âœ… è‡ªåŠ¨é€‚é…ç¯å¢ƒ
- âœ… æ— è·¨åŸŸé—®é¢˜
- âœ… ç¬¦åˆæœ€ä½³å®è·µ

### è®¿é—®æ–¹å¼

**æ¨è** âœ…:
```
å‰ç«¯: http://13.217.210.142/
API: è‡ªåŠ¨é€šè¿‡ /api ç›¸å¯¹è·¯å¾„è®¿é—®
```

**éªŒè¯**: æµè§ˆå™¨Networkæ ‡ç­¾åº”æ˜¾ç¤ºï¼š
```
http://13.217.210.142/api/v1/auth/login
```

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2026-02-01 15:37  
**é…ç½®çŠ¶æ€**: âœ… å®Œæˆ  
**æµ‹è¯•ç»“æœ**: âœ… å…¨éƒ¨é€šè¿‡  
**å¯ç”¨æ€§**: ğŸŸ¢ ç«‹å³å¯ç”¨
