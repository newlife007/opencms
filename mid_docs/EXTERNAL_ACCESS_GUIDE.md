# 🌐 OpenWan 外网访问配置完成

**配置时间**: 2026-02-01 15:21  
**状态**: ✅ **外网访问已启用**

---

## ✅ 修复内容

### 1. 修复前端配置
- 更新 `vite.config.js` 添加 `host: '0.0.0.0'`
- 前端现在监听所有网络接口
- 重启前端服务使配置生效

### 2. 验证服务监听状态
```
前端 (3000): 0.0.0.0:3000  ✅ (所有接口)
API  (8080): :::8080       ✅ (所有接口)
```

### 3. 测试外网访问
- ✅ API健康检查响应正常
- ✅ 前端页面访问正常

---

## 🌍 访问地址

### 服务器信息
- **内网IP**: 172.31.32.129
- **公网IP**: 13.217.210.142

### 外网访问地址

**前端界面:**
```
http://13.217.210.142:3000
```

**API服务:**
```
http://13.217.210.142:8080
```

**健康检查:**
```
http://13.217.210.142:8080/health
```

---

## 🧪 外网访问测试

### 浏览器访问

**打开以下URL:**

1. **前端首页**
   ```
   http://13.217.210.142:3000
   ```

2. **API健康检查**
   ```
   http://13.217.210.142:8080/health
   ```

### 命令行测试

**从任何机器执行:**

```bash
# 测试API
curl http://13.217.210.142:8080/health

# 测试前端
curl http://13.217.210.142:3000

# 测试登录
curl -X POST http://13.217.210.142:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# 获取文件列表
curl http://13.217.210.142:8080/api/v1/files
```

---

## 🔐 安全组检查

如果仍然无法访问，请检查AWS安全组配置：

### 需要开放的端口

| 端口 | 协议 | 来源 | 用途 |
|------|------|------|------|
| 3000 | TCP | 0.0.0.0/0 | 前端访问 |
| 8080 | TCP | 0.0.0.0/0 | API访问 |
| 22 | TCP | 您的IP | SSH管理 |

### AWS安全组配置步骤

1. 登录AWS控制台
2. 进入 EC2 → 安全组
3. 找到该实例的安全组
4. 添加入站规则：
   ```
   类型: 自定义TCP
   端口范围: 3000
   源: 0.0.0.0/0 (或您的特定IP)
   
   类型: 自定义TCP
   端口范围: 8080
   源: 0.0.0.0/0 (或您的特定IP)
   ```

---

## 📱 移动设备访问

您现在可以从任何设备访问：

- 手机浏览器: `http://13.217.210.142:3000`
- 平板电脑: `http://13.217.210.142:3000`
- 其他电脑: `http://13.217.210.142:3000`

---

## 🔧 配置文件更改

### vite.config.js
```javascript
server: {
  host: '0.0.0.0', // ← 新增：允许外网访问
  port: 3000,
  proxy: {
    '/api': {
      target: process.env.VITE_API_BASE_URL || 'http://localhost:8080',
      changeOrigin: true,
    },
  },
},
```

---

## 🛠️ 故障排查

### 如果无法访问

**1. 检查服务状态**
```bash
netstat -tuln | grep -E ":(8080|3000)"
```

应该看到:
```
tcp  0  0  0.0.0.0:3000   0.0.0.0:*  LISTEN
tcp6 0  0  :::8080        :::*       LISTEN
```

**2. 检查防火墙**
```bash
sudo iptables -L -n | grep -E "(3000|8080)"
```

**3. 测试本地访问**
```bash
# 从服务器内部测试
curl http://localhost:8080/health
curl http://localhost:3000
```

**4. 测试内网访问**
```bash
# 使用内网IP
curl http://172.31.32.129:8080/health
curl http://172.31.32.129:3000
```

**5. 测试外网访问**
```bash
# 使用公网IP
curl http://13.217.210.142:8080/health
curl http://13.217.210.142:3000
```

如果本地可以但外网不行 → **检查AWS安全组**

---

## 🎯 使用场景

### 团队协作
团队成员可以通过公网IP访问测试环境：
```
前端: http://13.217.210.142:3000
API:  http://13.217.210.142:8080
```

### API测试
使用Postman或其他工具测试API：
```
Base URL: http://13.217.210.142:8080
```

### 演示展示
可以直接分享链接给客户或管理层查看：
```
http://13.217.210.142:3000
```

---

## ⚠️ 安全建议

### 生产环境注意事项

1. **使用HTTPS**: 当前使用HTTP，生产环境应配置SSL证书
2. **限制IP访问**: 安全组可以限制特定IP范围访问
3. **添加认证**: API应该要求认证token
4. **使用域名**: 配置域名代替IP地址
5. **配置防火墙**: 使用WAF保护应用

### 临时测试环境

当前配置适合：
- ✅ 开发测试
- ✅ 内部演示
- ✅ 功能验证

不适合：
- ❌ 生产部署
- ❌ 公开发布
- ❌ 处理敏感数据

---

## 📊 网络架构

```
互联网
  ↓
防火墙/安全组 (端口 3000, 8080)
  ↓
公网IP: 13.217.210.142
  ↓
EC2 实例 (内网IP: 172.31.32.129)
  ├── 前端服务 :3000 (0.0.0.0)
  └── API服务  :8080 (:::)
```

---

## ✅ 验证结果

### 测试执行结果

```bash
$ curl http://13.217.210.142:8080/health
{"service":"openwan-api","status":"healthy","version":"1.0.0"}
✅ PASS

$ curl http://13.217.210.142:3000 | head -3
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
✅ PASS
```

---

## 📚 相关文档

- [STARTUP_SUCCESS_REPORT.md](./STARTUP_SUCCESS_REPORT.md) - 启动报告
- [QUICK_START.md](./QUICK_START.md) - 快速入门
- [scripts/quick-guide.sh](./scripts/quick-guide.sh) - 操作指南

---

## 🎉 总结

**问题**: 无法通过外网IP访问网站  
**原因**: 前端只监听 localhost (127.0.0.1)  
**解决**: 配置前端监听所有接口 (0.0.0.0)  
**结果**: ✅ **外网访问已启用**

### 现在可以访问

- ✅ 前端: http://13.217.210.142:3000
- ✅ API: http://13.217.210.142:8080
- ✅ 从任何设备和网络访问

**注意**: 如果AWS安全组未开放端口，请参考上文配置安全组规则。

---

**配置完成时间**: 2026-02-01 15:21  
**技术支持**: ATX Transform CLI
