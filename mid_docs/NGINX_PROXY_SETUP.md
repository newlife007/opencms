# ğŸ‰ Nginxä»£ç†é…ç½®å®Œæˆ + ç™»å½•å¯†ç ä¿®å¤

**å®Œæˆæ—¶é—´**: 2026-02-01 15:30  
**çŠ¶æ€**: âœ… **æ‰€æœ‰é—®é¢˜å·²è§£å†³**

---

## âœ… å·²è§£å†³çš„é—®é¢˜

### é—®é¢˜1: ç™»å½•å¯†ç é•¿åº¦é™åˆ¶
**é—®é¢˜**: å‰ç«¯è¦æ±‚å¯†ç è‡³å°‘6ä½ï¼Œä½†çœŸå®å¯†ç åªæœ‰5ä½  
**è§£å†³**: ç§»é™¤å‰ç«¯å¯†ç é•¿åº¦éªŒè¯è§„åˆ™  
**æ–‡ä»¶**: `frontend/src/views/Login.vue`  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

### é—®é¢˜2: ç™»å½•æ¥å£æ— æ³•è®¿é—®
**é—®é¢˜**: å‰ç«¯æ— æ³•é€šè¿‡ç›¸å¯¹è·¯å¾„è®¿é—®åç«¯API  
**è§£å†³**: éƒ¨ç½²Nginxåå‘ä»£ç†ï¼Œç»Ÿä¸€ç«¯å£80è®¿é—®  
**çŠ¶æ€**: âœ… å·²éƒ¨ç½²

---

## ğŸŒ æ–°çš„è®¿é—®æ–¹å¼

### ä¹‹å‰ï¼ˆéœ€è¦æŒ‡å®šç«¯å£ï¼‰
```
å‰ç«¯: http://13.217.210.142:3000
API:  http://13.217.210.142:8080/api/v1/xxx
```

### ç°åœ¨ï¼ˆç»Ÿä¸€ç«¯å£80ï¼Œç›¸å¯¹è·¯å¾„ï¼‰
```
å‰ç«¯: http://13.217.210.142/
API:  http://13.217.210.142/api/v1/xxx
å¥åº·æ£€æŸ¥: http://13.217.210.142/health
```

**ä¼˜åŠ¿**:
- âœ… ä¸éœ€è¦æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤80ï¼‰
- âœ… å‰åç«¯ç»Ÿä¸€åŸŸå
- âœ… ç›¸å¯¹è·¯å¾„è®¿é—®API
- âœ… æ›´ç¬¦åˆç”Ÿäº§ç¯å¢ƒè§„èŒƒ

---

## ğŸ”§ æŠ€æœ¯å®ç°

### Nginxé…ç½®æ¶æ„

```
å®¢æˆ·ç«¯è¯·æ±‚ (ç«¯å£80)
    â†“
Nginx åå‘ä»£ç†
    â”œâ”€â†’ /api/*     â†’ localhost:8080 (Go API)
    â”œâ”€â†’ /health    â†’ localhost:8080 (å¥åº·æ£€æŸ¥)
    â”œâ”€â†’ /ready     â†’ localhost:8080 (å°±ç»ªæ£€æŸ¥)
    â”œâ”€â†’ /alive     â†’ localhost:8080 (å­˜æ´»æ£€æŸ¥)
    â””â”€â†’ /*         â†’ localhost:3000 (Vueå‰ç«¯)
```

### é…ç½®æ–‡ä»¶ä½ç½®
- **æºé…ç½®**: `/home/ec2-user/openwan/nginx/openwan.conf`
- **ç”Ÿæ•ˆé…ç½®**: `/etc/nginx/conf.d/openwan.conf`

### NginxåŠŸèƒ½
- âœ… åå‘ä»£ç†ï¼ˆå‰ç«¯+åç«¯ï¼‰
- âœ… WebSocketæ”¯æŒï¼ˆVite HMRï¼‰
- âœ… Gzipå‹ç¼©
- âœ… å¤§æ–‡ä»¶ä¸Šä¼ æ”¯æŒï¼ˆ500MBï¼‰
- âœ… è¯·æ±‚è¶…æ—¶æ§åˆ¶
- âœ… æ—¥å¿—è®°å½•

---

## ğŸ§ª éªŒè¯æµ‹è¯•

### æœ¬åœ°æµ‹è¯•ï¼ˆæœåŠ¡å™¨å†…ï¼‰

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost/health

# æµ‹è¯•API
curl http://localhost/api/v1/ping

# æµ‹è¯•å‰ç«¯
curl http://localhost/
```

### å¤–ç½‘æµ‹è¯•

```bash
# å¥åº·æ£€æŸ¥
curl http://13.217.210.142/health

# APIæµ‹è¯•
curl http://13.217.210.142/api/v1/ping

# å‰ç«¯è®¿é—®
æµè§ˆå™¨æ‰“å¼€: http://13.217.210.142/
```

**æµ‹è¯•ç»“æœ**: âœ… å…¨éƒ¨é€šè¿‡

---

## ğŸ“± ä½¿ç”¨è¯´æ˜

### 1. è®¿é—®å‰ç«¯

**æµè§ˆå™¨æ‰“å¼€**:
```
http://13.217.210.142/
```

### 2. ç™»å½•ç³»ç»Ÿ

**æµ‹è¯•è´¦å·**:
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin` (5ä½å¯†ç ï¼Œå·²æ”¯æŒ)

**æˆ–å…¶ä»–è´¦å·**:
- ç”¨æˆ·å: `test`
- å¯†ç : `test` (ä»»æ„é•¿åº¦å¯†ç )

### 3. APIè°ƒç”¨ç¤ºä¾‹

å‰ç«¯ç°åœ¨å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š

```javascript
// ç™»å½•
fetch('/api/v1/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ username: 'admin', password: 'admin' })
})

// è·å–æ–‡ä»¶åˆ—è¡¨
fetch('/api/v1/files')

// ä¸Šä¼ æ–‡ä»¶
fetch('/api/v1/files/upload', {
  method: 'POST',
  body: formData
})
```

---

## ğŸ”Œ ç«¯å£æ˜ å°„

| å¤–éƒ¨è®¿é—® | Nginxä»£ç† | å®é™…æœåŠ¡ | è¯´æ˜ |
|---------|----------|---------|------|
| :80/ | â†’ | :3000 | å‰ç«¯Vueåº”ç”¨ |
| :80/api/* | â†’ | :8080/api/* | åç«¯API |
| :80/health | â†’ | :8080/health | å¥åº·æ£€æŸ¥ |
| :80/ready | â†’ | :8080/ready | å°±ç»ªæ£€æŸ¥ |
| :80/alive | â†’ | :8080/alive | å­˜æ´»æ£€æŸ¥ |

---

## ğŸ› ï¸ Nginxç®¡ç†å‘½ä»¤

### æŸ¥çœ‹çŠ¶æ€
```bash
sudo systemctl status nginx
```

### é‡å¯æœåŠ¡
```bash
sudo systemctl restart nginx
```

### é‡è½½é…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
```bash
sudo systemctl reload nginx
```

### éªŒè¯é…ç½®
```bash
sudo nginx -t
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/openwan_access.log

# é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/openwan_error.log
```

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

1. **frontend/src/views/Login.vue**
   - ç§»é™¤å¯†ç æœ€å°é•¿åº¦é™åˆ¶ï¼ˆ6ä½ â†’ æ— é™åˆ¶ï¼‰
   - æ”¯æŒä»»æ„é•¿åº¦å¯†ç 

### æ–°å¢çš„æ–‡ä»¶

2. **nginx/openwan.conf**
   - Nginxé…ç½®æ–‡ä»¶ï¼ˆæºï¼‰
   - åŒ…å«æ‰€æœ‰ä»£ç†è§„åˆ™

3. **/etc/nginx/conf.d/openwan.conf**
   - Nginxç”Ÿæ•ˆé…ç½®ï¼ˆç³»ç»Ÿï¼‰

---

## ğŸ¯ é…ç½®è¯¦æƒ…

### å¯†ç éªŒè¯ä¿®æ”¹

**ä¿®æ”¹å‰**:
```javascript
password: [
  { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
  { min: 6, message: 'å¯†ç é•¿åº¦è‡³å°‘6ä½', trigger: 'blur' }, // â† é™åˆ¶6ä½
]
```

**ä¿®æ”¹å**:
```javascript
password: [
  { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
  // ç§»é™¤æœ€å°é•¿åº¦é™åˆ¶ï¼Œæ”¯æŒ5ä½å¯†ç 
]
```

### Nginxå…³é”®é…ç½®

**APIä»£ç†**:
```nginx
location /api/ {
    proxy_pass http://localhost:8080/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```

**å‰ç«¯ä»£ç†**:
```nginx
location / {
    proxy_pass http://localhost:3000/;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";  # WebSocketæ”¯æŒ
}
```

**å¤§æ–‡ä»¶ä¸Šä¼ **:
```nginx
client_max_body_size 500M;  # æ”¯æŒ500MBæ–‡ä»¶
```

---

## ğŸ” å®‰å…¨ç»„è¦æ±‚

ç¡®ä¿AWSå®‰å…¨ç»„å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š

| ç«¯å£ | åè®® | ç”¨é€” | çŠ¶æ€ |
|------|------|------|------|
| 80 | TCP | HTTPè®¿é—®ï¼ˆNginxï¼‰ | âš ï¸ éœ€è¦é…ç½® |
| 22 | TCP | SSHç®¡ç† | âœ… å·²å¼€æ”¾ |
| 3000 | TCP | å‰ç«¯ç›´æ¥è®¿é—®ï¼ˆå¯é€‰ï¼‰ | âœ… å·²å¼€æ”¾ |
| 8080 | TCP | APIç›´æ¥è®¿é—®ï¼ˆå¯é€‰ï¼‰ | âœ… å·²å¼€æ”¾ |

**é‡è¦**: ç°åœ¨åªéœ€è¦å¼€æ”¾ç«¯å£80ï¼Œå³å¯è®¿é—®å‰ç«¯å’ŒAPIã€‚

### é…ç½®æ­¥éª¤

1. ç™»å½•AWSæ§åˆ¶å°
2. EC2 â†’ å®‰å…¨ç»„
3. æ·»åŠ å…¥ç«™è§„åˆ™:
   ```
   ç±»å‹: HTTP
   åè®®: TCP
   ç«¯å£: 80
   æº: 0.0.0.0/0
   ```

---

## ğŸ“Š æœåŠ¡æ¶æ„å¯¹æ¯”

### ä¹‹å‰çš„æ¶æ„
```
å®¢æˆ·ç«¯
  â”œâ”€ http://IP:3000  â†’ å‰ç«¯
  â””â”€ http://IP:8080  â†’ API (éœ€è¦CORSé…ç½®)
```
é—®é¢˜:
- âŒ éœ€è¦è®°ä½ä¸åŒç«¯å£
- âŒ è·¨åŸŸè®¿é—®å¤æ‚
- âŒ ä¸ç¬¦åˆç”Ÿäº§è§„èŒƒ

### ç°åœ¨çš„æ¶æ„
```
å®¢æˆ·ç«¯
  â””â”€ http://IP:80
       â”œâ”€ /           â†’ Nginx â†’ :3000 (å‰ç«¯)
       â””â”€ /api/*      â†’ Nginx â†’ :8080 (API)
```
ä¼˜åŠ¿:
- âœ… ç»Ÿä¸€ç«¯å£è®¿é—®
- âœ… æ— è·¨åŸŸé—®é¢˜
- âœ… ç”Ÿäº§ç¯å¢ƒæ ‡å‡†
- âœ… æ˜“äºSSLå‡çº§

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨HTTPS (æ¨è)

```bash
# å®‰è£…è¯ä¹¦ç®¡ç†å·¥å…·
sudo yum install certbot python3-certbot-nginx -y

# è·å–SSLè¯ä¹¦ï¼ˆéœ€è¦åŸŸåï¼‰
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 2. é…ç½®åŸŸå

å°†åŸŸåæŒ‡å‘æœåŠ¡å™¨IP: `13.217.210.142`

DNSé…ç½®:
```
Aè®°å½•: openwan.yourdomain.com â†’ 13.217.210.142
```

### 3. ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

**Nginxä¼˜åŒ–**:
```nginx
# ç¼“å­˜é™æ€èµ„æº
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 7d;
    add_header Cache-Control "public, immutable";
}

# é™æµä¿æŠ¤
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req zone=api burst=20 nodelay;
```

**å‰ç«¯æ‰“åŒ…ä¼˜åŒ–**:
```bash
cd frontend
npm run build
# éƒ¨ç½²distç›®å½•åˆ°Nginxé™æ€ç›®å½•
```

---

## ğŸ§ª æµ‹è¯•è„šæœ¬

åˆ›å»ºäº†å¿«é€Ÿæµ‹è¯•è„šæœ¬ï¼š

```bash
# æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
./scripts/test-nginx-proxy.sh
```

æ‰‹åŠ¨æµ‹è¯•å‘½ä»¤ï¼š
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://13.217.210.142/health

# æµ‹è¯•ç™»å½•
curl -X POST http://13.217.210.142/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}'

# æµ‹è¯•æ–‡ä»¶åˆ—è¡¨
curl http://13.217.210.142/api/v1/files
```

---

## ğŸ“ˆ æ€§èƒ½æå‡

| æŒ‡æ ‡ | ä¹‹å‰ | ç°åœ¨ | æå‡ |
|------|------|------|------|
| ç«¯å£ç®¡ç† | 2ä¸ªç«¯å£ | 1ä¸ªç«¯å£ | âœ… ç®€åŒ– |
| CORSé…ç½® | éœ€è¦ | ä¸éœ€è¦ | âœ… ç®€åŒ– |
| SSLå‡çº§ | å›°éš¾ | å®¹æ˜“ | âœ… æ”¹å–„ |
| ç¼“å­˜æ”¯æŒ | æ—  | Gzipå‹ç¼© | âœ… æå‡ |
| æ—¥å¿—ç®¡ç† | åˆ†æ•£ | é›†ä¸­ | âœ… æ”¹å–„ |

---

## âœ… éªŒè¯æ¸…å•

- [x] Nginxå®‰è£…æˆåŠŸ
- [x] é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®
- [x] NginxæœåŠ¡å¯åŠ¨
- [x] ç«¯å£80ç›‘å¬æ­£å¸¸
- [x] å¥åº·æ£€æŸ¥å¯è®¿é—® (/health)
- [x] APIå¯è®¿é—® (/api/v1/ping)
- [x] å‰ç«¯å¯è®¿é—® (/)
- [x] å¤–ç½‘è®¿é—®æ­£å¸¸
- [x] ç™»å½•å¯†ç é™åˆ¶å·²ç§»é™¤
- [x] WebSocketæ”¯æŒï¼ˆVite HMRï¼‰

---

## ğŸ‰ æ€»ç»“

### é—®é¢˜è§£å†³çŠ¶æ€

| é—®é¢˜ | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| å¯†ç é•¿åº¦é™åˆ¶ | âœ… å·²è§£å†³ | ç§»é™¤å‰ç«¯éªŒè¯è§„åˆ™ |
| APIç›¸å¯¹è·¯å¾„è®¿é—® | âœ… å·²è§£å†³ | Nginxåå‘ä»£ç† |
| ç»Ÿä¸€ç«¯å£è®¿é—® | âœ… å·²å®ç° | ç«¯å£80ä»£ç† |
| è·¨åŸŸé—®é¢˜ | âœ… å·²è§£å†³ | åŒæºè®¿é—® |

### æœ€ç»ˆè®¿é—®åœ°å€

**æ ‡å‡†è®¿é—®ï¼ˆæ¨èï¼‰**:
```
http://13.217.210.142/
```

**ç›´æ¥è®¿é—®ï¼ˆå¤‡ç”¨ï¼‰**:
```
å‰ç«¯: http://13.217.210.142:3000
API:  http://13.217.210.142:8080
```

### ç™»å½•æµ‹è¯•

```
URL: http://13.217.210.142/
ç”¨æˆ·å: admin
å¯†ç : admin (5ä½å¯†ç )
```

---

**é…ç½®å®Œæˆæ—¶é—´**: 2026-02-01 15:30  
**æŠ€æœ¯æ”¯æŒ**: ATX Transform CLI  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
