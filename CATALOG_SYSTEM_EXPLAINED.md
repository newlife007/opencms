# OpenWan 目录系统（Catalog）详解

**创建时间**: 2026-02-05 14:45 UTC  
**目的**: 解释目录系统的作用和使用方法

---

## 📚 什么是"目录"（Catalog）？

### 简单理解

**目录 = 文件的元数据字段配置**

OpenWan的"目录"不是文件夹，而是**动态表单字段定义系统**，用于配置上传文件时需要填写的元数据信息。

---

## 🎯 目录系统的作用

### 核心功能

1. **定义元数据字段**: 为不同类型的文件配置需要填写哪些信息
2. **动态表单生成**: 根据配置自动生成文件编目表单
3. **分类型配置**: 视频、音频、图片、富媒体各有独立的字段配置
4. **层级化组织**: 支持字段分组，方便管理大量元数据

---

## 📋 实际应用场景

### 场景1: 视频文件上传

当用户上传一个**视频文件**时，除了文件本身，还需要填写：

```
基本信息
├─ 标题 *（必填）
├─ 描述
└─ 关键词

视频信息
├─ 导演
├─ 演员
├─ 时长（分钟）
├─ 分辨率
└─ 格式

版权信息
├─ 版权方
├─ 授权日期
└─ 使用范围
```

这些字段就是通过**目录配置**定义的！

---

### 场景2: 音频文件上传

上传**音频文件**时需要的信息可能不同：

```
基本信息
├─ 标题 *
├─ 描述
└─ 关键词

音频信息
├─ 艺术家
├─ 专辑
├─ 时长
├─ 比特率
└─ 采样率

授权信息
├─ 版权方
└─ 授权类型
```

**不同文件类型，不同字段配置！**

---

## 🔧 目录配置界面

### 位置
**系统管理 → 目录配置**

### 界面布局

```
┌──────────────────────────────────────────────────┐
│  目录配置     [视频] [音频] [图片] [富媒体]       │
├──────────────────────────────────────────────────┤
│  左侧：目录结构树     │  右侧：字段编辑表单      │
│                      │                          │
│  📋 基本信息          │  字段名称: title         │
│    ├─ 标题 (text)    │  显示标签: 标题          │
│    ├─ 描述 (textarea)│  字段类型: [文本输入▼]   │
│    └─ 关键词 (text)  │  验证规则: [✓] 必填      │
│  📋 视频信息          │  排序权重: 1             │
│    ├─ 导演 (text)    │  状态: [✓ 启用]         │
│    ├─ 演员 (text)    │                          │
│    ├─ 时长 (number)  │  [创建] [重置]           │
│    └─ 格式 (select)  │                          │
│  📋 版权信息          │                          │
│                      │                          │
│  [添加根目录]         │                          │
└──────────────────────────────────────────────────┘
```

---

## 🎨 字段类型说明

### 支持的字段类型

| 字段类型 | 说明 | 示例用途 |
|---------|------|---------|
| **文本输入** (text) | 单行文本框 | 标题、导演、演员 |
| **多行文本** (textarea) | 多行文本框 | 描述、剧情简介 |
| **数字输入** (number) | 数字输入框 | 时长、大小、年份 |
| **日期选择** (date) | 日期选择器 | 发布日期、授权日期 |
| **下拉选择** (select) | 下拉菜单 | 格式、分辨率、类型 |
| **单选框** (radio) | 单选按钮组 | 版权类型、使用范围 |
| **复选框** (checkbox) | 多选框 | 标签、特性 |
| **分组** (group) | 字段分组 | 基本信息、视频信息 |

---

## 📝 配置示例

### 示例1: 配置"导演"字段

```
字段名称: director
显示标签: 导演
字段类型: 文本输入
默认值: （空）
占位符: 请输入导演姓名
验证规则: （不必填）
排序权重: 5
状态: 启用
```

**用户上传视频时会看到**:
```
导演: [请输入导演姓名_________]
```

---

### 示例2: 配置"视频格式"字段

```
字段名称: format
显示标签: 视频格式
字段类型: 下拉选择
选项配置:
  MP4
  AVI
  MOV
  FLV
  MKV
默认值: MP4
验证规则: [✓] 必填
排序权重: 10
状态: 启用
```

**用户上传视频时会看到**:
```
视频格式: * [MP4 ▼]
         ├─ MP4
         ├─ AVI
         ├─ MOV
         ├─ FLV
         └─ MKV
```

---

### 示例3: 配置字段分组

```
字段名称: video_info
显示标签: 视频信息
字段类型: 分组
上级目录: （根目录）
排序权重: 2
状态: 启用
```

**然后在"视频信息"分组下添加子字段**:
- 导演 (子字段)
- 演员 (子字段)
- 时长 (子字段)

**用户看到的表单**:
```
━━━━━━━━━━━━━━━━━━━━
  视频信息
━━━━━━━━━━━━━━━━━━━━
导演: [_______________]
演员: [_______________]
时长: [_____] 分钟
```

---

## 🔄 数据存储

### catalog_info字段

配置的目录字段，用户填写的数据存储在 `ow_files.catalog_info` 字段中，格式为**JSON**：

```json
{
  "title": "产品宣传片2024",
  "description": "公司新产品宣传视频",
  "director": "张三",
  "actors": "李四, 王五",
  "duration": 120,
  "format": "MP4",
  "resolution": "1920x1080",
  "copyright_holder": "某某公司",
  "authorization_date": "2024-01-01"
}
```

---

## 🎯 使用流程

### 管理员配置流程

1. **进入目录配置页面**
   - 系统管理 → 目录配置

2. **选择文件类型**
   - 点击顶部标签：[视频] [音频] [图片] [富媒体]

3. **添加根目录（分组）**
   - 点击 [添加根目录]
   - 字段名称: `basic_info`
   - 显示标签: `基本信息`
   - 字段类型: `分组`
   - 点击 [创建]

4. **添加子字段**
   - 选择刚创建的"基本信息"分组
   - 点击 [+] 按钮（添加子字段）
   - 填写字段配置
   - 点击 [创建]

5. **重复步骤3-4**
   - 创建更多分组和字段

6. **调整顺序**
   - 拖拽字段调整显示顺序

---

### 用户使用流程

1. **上传文件**
   - 文件管理 → 文件上传
   - 选择文件类型（视频/音频/图片/富媒体）
   - 上传文件

2. **填写元数据**
   - 系统根据目录配置**自动生成表单**
   - 用户填写各个字段
   - 必填字段必须填写

3. **提交编目**
   - 点击 [提交]
   - 数据保存到 `catalog_info` 字段

4. **后续编辑**
   - 可以随时进入"编目"功能修改元数据

---

## 🔍 搜索和检索

### 全文搜索

配置的元数据字段会被**Sphinx搜索引擎索引**，用户可以通过这些元数据搜索文件：

```
搜索："张三导演"
结果：返回所有导演字段包含"张三"的视频
```

### 高级筛选

前端可以根据元数据字段创建高级筛选器：

```
文件类型: [视频]
分辨率: [1920x1080]
时长: [60-120分钟]
导演: [张三]
```

---

## 💡 实际应用案例

### 案例1: 企业培训视频库

**目录配置**:
```
📋 课程信息
   ├─ 课程名称 *
   ├─ 讲师
   ├─ 课程分类 (下拉)
   ├─ 难度级别 (下拉: 初级/中级/高级)
   └─ 学时 (数字)

📋 内容描述
   ├─ 课程简介 *
   ├─ 学习目标
   └─ 先修课程

📋 技术参数
   ├─ 视频时长
   ├─ 分辨率
   └─ 字幕语言 (多选)
```

---

### 案例2: 音乐素材库

**目录配置**:
```
📋 音乐信息
   ├─ 曲名 *
   ├─ 艺术家
   ├─ 专辑
   ├─ 风格 (下拉: 流行/摇滚/古典/电子...)
   ├─ 节奏 (下拉: 快/中/慢)
   └─ 情绪 (多选: 欢快/悲伤/激昂/平静...)

📋 技术参数
   ├─ 时长
   ├─ 比特率
   ├─ 采样率
   └─ 音频格式

📋 授权信息
   ├─ 版权方 *
   ├─ 授权类型 (单选: 独家/非独家)
   └─ 使用场景 (多选: 商用/个人/教育...)
```

---

### 案例3: 产品图片库

**目录配置**:
```
📋 图片信息
   ├─ 图片名称 *
   ├─ 产品编号
   ├─ 产品分类 (下拉)
   ├─ 拍摄角度 (下拉: 正面/侧面/顶部/细节)
   └─ 拍摄场景 (下拉: 白底/实景/模特...)

📋 技术参数
   ├─ 分辨率
   ├─ 颜色模式 (RGB/CMYK)
   ├─ DPI
   └─ 是否带水印 (单选: 是/否)

📋 版权信息
   ├─ 摄影师
   ├─ 拍摄日期
   └─ 使用权限 (多选)
```

---

## 🔧 技术实现

### 数据库表结构

#### ow_catalog 表
```sql
id            INT          主键
parent_id     INT          父字段ID (0=根字段)
path          VARCHAR(255) 层级路径 (如: "1,5,12")
name          VARCHAR(64)  字段名称 (英文, 如: "director")
description   VARCHAR(255) 字段描述
weight        INT          排序权重 (越大越靠前)
enabled       TINYINT      是否启用 (1/0)
created       INT          创建时间 (Unix时间戳)
updated       INT          更新时间 (Unix时间戳)
```

#### ow_files 表
```sql
...
catalog_info  TEXT         元数据JSON (存储用户填写的值)
...
```

### JSON存储示例

用户填写的元数据存储在 `catalog_info` 字段：

```json
{
  "basic_info": {
    "title": "产品演示视频",
    "description": "展示产品核心功能",
    "keywords": "产品, 演示, 功能"
  },
  "video_info": {
    "director": "张三",
    "actors": "李四, 王五",
    "duration": 180,
    "format": "MP4",
    "resolution": "1920x1080"
  },
  "copyright_info": {
    "copyright_holder": "某某公司",
    "authorization_date": "2024-01-01",
    "usage_scope": ["商用", "宣传"]
  }
}
```

---

## ⚙️ 目录配置界面功能

### 当前状态
- ✅ 数据库表存在
- ✅ 后端API已实现
- ✅ 前端界面已开发
- ❌ 表中无数据（需要管理员配置）

### 界面功能

#### 1. 文件类型切换
顶部标签切换不同文件类型的配置：
- [视频] - 配置视频文件的元数据字段
- [音频] - 配置音频文件的元数据字段
- [图片] - 配置图片文件的元数据字段
- [富媒体] - 配置富媒体文件的元数据字段

#### 2. 树形结构显示
左侧树形显示字段层级关系：
```
📋 基本信息 (group)
   ├─ 标题 (text)
   ├─ 描述 (textarea)
   └─ 关键词 (text)
📋 视频信息 (group)
   ├─ 导演 (text)
   ├─ 演员 (text)
   └─ 时长 (number)
```

#### 3. 字段操作
- **添加根目录**: 创建顶级分组
- **添加子字段**: 在分组下添加字段
- **编辑**: 修改字段配置
- **删除**: 删除字段
- **拖拽**: 调整字段顺序

#### 4. 字段配置表单
- 字段名称 (name): 英文标识符
- 显示标签 (label): 中文显示名称
- 字段类型 (type): text/textarea/number/date/select/radio/checkbox/group
- 选项配置: 用于select/radio/checkbox类型
- 默认值: 字段默认值
- 占位符: 输入框提示文字
- 验证规则: 必填、邮箱、URL等
- 排序权重: 控制显示顺序
- 状态: 启用/禁用

---

## 📖 总结

### 目录系统的本质

**目录 (Catalog) = 动态元数据配置系统**

- **不是** 文件夹或目录
- **是** 文件元数据字段的定义
- **用于** 生成文件上传/编目表单
- **目的** 让不同类型文件有不同的元数据结构

### 核心价值

1. **灵活性**: 管理员可以自定义任意字段
2. **分类型**: 不同文件类型有独立配置
3. **层级化**: 支持字段分组，结构清晰
4. **可搜索**: 所有元数据都可被搜索和筛选
5. **标准化**: 强制用户按规范填写元数据

### 与分类的区别

| 项目 | 分类 (Category) | 目录 (Catalog) |
|-----|----------------|---------------|
| **作用** | 文件的归类和组织 | 文件的元数据字段配置 |
| **类比** | 图书馆的书架分区 | 图书的书目卡片格式 |
| **数量** | 每个文件属于1个分类 | 每种类型文件有1套目录配置 |
| **示例** | 教学视频、宣传视频 | 导演、演员、时长等字段 |
| **用户体验** | 选择文件放在哪里 | 填写文件详细信息 |

---

## 🚀 快速开始

### 第一次使用目录配置

1. **登录系统** (admin/admin123)

2. **进入目录配置**
   - 点击左侧菜单 **系统管理**
   - 点击 **目录配置**

3. **选择文件类型**
   - 点击顶部 **[视频]** 标签

4. **创建第一个分组**
   - 点击 **[添加根目录]**
   - 字段名称: `basic_info`
   - 显示标签: `基本信息`
   - 字段类型: 选择 `分组`
   - 点击 **[创建]**

5. **添加第一个字段**
   - 点击树中的 "基本信息"
   - 点击 **[+]** 按钮
   - 字段名称: `title`
   - 显示标签: `标题`
   - 字段类型: `文本输入`
   - 验证规则: 勾选 `必填`
   - 点击 **[创建]**

6. **继续添加更多字段**
   - 重复步骤5，添加：
     - 描述 (textarea)
     - 关键词 (text)
     - 导演 (text)
     - 时长 (number)
     - ...

7. **测试效果**
   - 进入 **文件上传** 页面
   - 选择文件类型为 **视频**
   - 上传文件
   - 查看是否出现刚配置的字段

---

**目录配置完成后，用户上传文件时会看到您配置的所有字段！**

---

**文档创建时间**: 2026-02-05 14:45 UTC  
**版本**: 1.0  
**状态**: ✅ 完整说明
